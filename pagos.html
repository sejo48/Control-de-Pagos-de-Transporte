<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Pagos de Transporte</title>
    <!-- Tailwind CSS para un diseño rápido y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts para una mejor tipografía -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilo personalizado para la fuente Inter */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* Evita el destello azul en móviles al tocar */
        }
        /* Estilo para el mensaje de notificación */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .notification.show {
            opacity: 1;
        }
        .notification.success {
            background-color: #28a745; /* Verde */
        }
        .notification.error {
            background-color: #dc3545; /* Rojo */
        }
        /* Estilos para los inputs en modo edición */
        .edit-input {
            width: 100%;
            padding: 2px 4px;
            border: 1px solid #cbd5e1;
            border-radius: 0.25rem;
            background-color: #f8fafc;
        }
        /* Estilos para el modal de confirmación */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-box {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-2 sm:p-4 md:p-6 max-w-5xl">
        <!-- Encabezado de la aplicación -->
        <header class="text-center my-4 sm:my-8">
            <h1 class="text-2xl sm:text-4xl font-bold text-gray-900">Control de Pagos de Transporte</h1>
            <p class="text-gray-600 mt-2 text-sm sm:text-base">Gestiona los pagos pendientes de forma sencilla.</p>
        </header>

        <main>
            <!-- Columna para la lista de deudores y el total -->
            <div class="bg-white p-3 sm:p-6 rounded-lg shadow-md">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 pb-4 border-b border-gray-200 gap-4">
                    <div class="flex-grow">
                         <h2 class="text-xl sm:text-2xl font-semibold">Lista de Deudores</h2>
                    </div>
                    <div class="w-full sm:w-auto flex justify-between sm:justify-end sm:gap-x-4 gap-y-2 text-right">
                        <div class="text-xs sm:text-base">
                            <p class="text-gray-600">Pendiente:</p>
                            <p id="total-amount" class="text-base sm:text-xl font-bold text-red-600">₡0.00</p>
                        </div>
                        <div class="text-xs sm:text-base">
                            <p class="text-gray-600">General:</p>
                            <p id="total-general" class="text-base sm:text-xl font-bold text-gray-800">₡0.00</p>
                        </div>
                    </div>
                </div>
                 <div class="mb-4">
                    <button id="reset-month-btn" class="w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-md hover:bg-yellow-600 transition-colors duration-300 active:bg-yellow-700">
                        Reiniciar Mes
                    </button>
                </div>
                <!-- Contenedor de la lista de deudores -->
                <div id="debtors-list-container">
                    <div id="debtors-list" class="space-y-1">
                        <!-- Los deudores se insertarán aquí dinámicamente -->
                        <p class="text-gray-500 text-center py-4">No hay deudores registrados.</p>
                    </div>
                </div>
                <div class="mt-4">
                    <button id="bottom-action-btn" class="w-full font-bold py-3 px-4 rounded-md transition-colors duration-300 active:bg-gray-400">
                        + Agregar Fila
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de confirmación para eliminar -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <h3 class="text-lg font-bold mb-4">Confirmar Eliminación</h3>
            <p class="mb-4">Para continuar, ingresa la clave de seguridad.</p>
            <input type="password" id="delete-password-input" inputmode="numeric" pattern="[0-9]*" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4" placeholder="Clave (8384)">
            <div class="flex justify-end gap-4">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Cancelar</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Elemento para mostrar notificaciones -->
    <div id="notification" class="notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referencias a los elementos del DOM
            const debtorsList = document.getElementById('debtors-list');
            const totalAmountEl = document.getElementById('total-amount');
            const totalGeneralEl = document.getElementById('total-general');
            const bottomActionButton = document.getElementById('bottom-action-btn');
            const resetMonthBtn = document.getElementById('reset-month-btn');
            const notificationEl = document.getElementById('notification');
            const deleteModal = document.getElementById('delete-modal');
            const passwordInput = document.getElementById('delete-password-input');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

            let indexToDelete = null;

            // Lista inicial de deudores actualizada
            const initialDebtors = [
                { id: 1, name: 'Elvira', amount: '30000.00', paid: true },
                { id: 2, name: 'Rocio', amount: '50000.00', paid: true },
                { id: 3, name: 'Marielos', amount: '30000.00', paid: true },
                { id: 4, name: 'Gudelia', amount: '35000.00', paid: true },
                { id: 5, name: 'Bertilia', amount: '30000.00', paid: true },
                { id: 6, name: 'Elizabeth', amount: '40000.00', paid: true },
                { id: 7, name: 'Josefa', amount: '35000.00', paid: true },
                { id: 8, name: 'Carmen', amount: '35000.00', paid: true },
                { id: 9, name: 'Margarita', amount: '40000.00', paid: true },
                { id: 10, name: 'Nannys', amount: '10000.00', paid: true },
                { id: 11, name: 'Carmencita', amount: '30000.00', paid: true },
                { id: 12, name: 'Anibal', amount: '50000.00', paid: true },
                { id: 13, name: 'Fanny', amount: '45000.00', paid: true },
                { id: 14, name: 'Priscila', amount: '50000.00', paid: true }
            ];

            let debtors = JSON.parse(localStorage.getItem('debtors'));
            if (!debtors || debtors.length === 0) {
                debtors = initialDebtors;
            }

            function showNotification(message, type = 'success') {
                notificationEl.textContent = message;
                notificationEl.className = `notification ${type} show`;
                setTimeout(() => {
                    notificationEl.className = 'notification';
                }, 3000);
            }

            function saveDebtors() {
                localStorage.setItem('debtors', JSON.stringify(debtors));
            }

            function formatCurrency(number) {
                return `₡${parseFloat(number).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            function renderDebtors() {
                debtorsList.innerHTML = '';

                if (debtors.length === 0) {
                    debtorsList.innerHTML = '<p class="text-gray-500 text-center py-4">No hay deudores registrados.</p>';
                } else {
                    debtors.forEach((debtor, index) => {
                        const debtorEl = document.createElement('div');
                        const isPaid = debtor.paid;
                        const isEditing = debtor.editing;
                        
                        debtorEl.className = `flex items-center p-3 rounded-md transition-colors duration-200 ${isPaid ? 'bg-green-50 text-gray-500' : 'bg-white hover:bg-gray-50'}`;
                        
                        const nameContent = isEditing ? `<input type="text" value="${debtor.name}" class="edit-input name-edit-input">` : `<div class="font-medium ${isPaid ? 'line-through' : 'text-gray-800'}">${debtor.name}</div>`;
                        const amountContent = isEditing ? `<input type="number" value="${debtor.amount}" class="edit-input amount-edit-input text-right">` : `<div class="font-medium text-right ${isPaid ? 'line-through' : 'text-gray-800'}">${formatCurrency(debtor.amount)}</div>`;
                        
                        debtorEl.innerHTML = `
                            <div class="w-8 text-gray-500 font-medium">${index + 1}.</div>
                            <div class="flex-grow pr-2">${nameContent}</div>
                            <div class="w-1/3 sm:w-1/4 pr-2">${amountContent}</div>
                            <div class="w-auto flex justify-end items-center space-x-2 sm:space-x-3">
                                <input type="checkbox" data-index="${index}" class="paid-checkbox h-5 w-5 rounded border-gray-400 text-blue-600 focus:ring-blue-500 cursor-pointer" ${isPaid ? 'checked' : ''} ${isEditing ? 'disabled' : ''}>
                                <button data-index="${index}" class="edit-btn text-gray-400 hover:text-blue-600" ${isEditing ? 'style="display:none;"' : ''}>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" /></svg>
                                </button>
                                <button data-index="${index}" class="delete-btn text-gray-400 hover:text-red-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                </button>
                            </div>
                        `;
                        debtorsList.appendChild(debtorEl);
                    });
                }

                updateTotalsAndButton();
            }

            function updateTotalsAndButton() {
                const totalPending = debtors.filter(d => !d.paid).reduce((sum, d) => sum + parseFloat(d.amount), 0);
                totalAmountEl.textContent = formatCurrency(totalPending);

                const totalGeneral = debtors.reduce((sum, d) => sum + parseFloat(d.amount), 0);
                totalGeneralEl.textContent = formatCurrency(totalGeneral);

                const isAnyRowEditing = debtors.some(d => d.editing);
                if (isAnyRowEditing) {
                    bottomActionButton.textContent = 'Guardar Cambios';
                    bottomActionButton.className = 'w-full font-bold py-3 px-4 rounded-md transition-colors duration-300 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800';
                    bottomActionButton.dataset.mode = 'save';
                } else {
                    bottomActionButton.textContent = '+ Agregar Fila';
                    bottomActionButton.className = 'w-full font-bold py-3 px-4 rounded-md transition-colors duration-300 bg-gray-200 text-gray-700 hover:bg-gray-300 active:bg-gray-400';
                    bottomActionButton.dataset.mode = 'add';
                }
            }
            
            function saveChanges() {
                const editIndex = debtors.findIndex(d => d.editing);
                if (editIndex === -1) return;

                const rowEl = debtorsList.children[editIndex];
                const newNameInput = rowEl.querySelector('.name-edit-input');
                const newAmountInput = rowEl.querySelector('.amount-edit-input');

                if (newNameInput && newAmountInput) {
                    const newName = newNameInput.value.trim();
                    const newAmount = newAmountInput.value;

                    if (newName && newAmount !== '' && !isNaN(parseFloat(newAmount)) && parseFloat(newAmount) >= 0) {
                        debtors[editIndex].name = newName;
                        debtors[editIndex].amount = parseFloat(newAmount).toFixed(2);
                        debtors[editIndex].editing = false;
                        saveAndRender();
                        showNotification('Cambios guardados.', 'success');
                    } else {
                        showNotification('Nombre y monto deben ser válidos.', 'error');
                    }
                }
            }

            function addRow() {
                saveChanges(); // Guardar cualquier edición pendiente antes de agregar una nueva fila
                debtors.forEach(d => d.editing = false);
                const newDebtor = { id: Date.now(), name: 'Nuevo Deudor', amount: '0.00', paid: false, editing: true };
                debtors.push(newDebtor);
                saveAndRender();
            }
            
            function resetMonth() {
                if (confirm("¿Estás seguro de que deseas reiniciar todos los pagos para un nuevo mes? Esta acción desmarcará todas las casillas.")) {
                    debtors.forEach(debtor => {
                        debtor.paid = false;
                    });
                    saveAndRender();
                    showNotification('Se ha iniciado un nuevo mes de cobro.', 'success');
                }
            }

            function handleBottomButtonClick() {
                if (bottomActionButton.dataset.mode === 'add') {
                    addRow();
                } else {
                    saveChanges();
                }
            }

            function handleDebtorListClick(e) {
                const target = e.target;

                if (target.classList.contains('paid-checkbox')) {
                    const index = parseInt(target.dataset.index, 10);
                    if (isNaN(index) || (debtors[index] && debtors[index].editing)) return;
                    debtors[index].paid = target.checked;
                    saveAndRender();
                    return;
                }

                const button = target.closest('button');
                if (!button) return;

                const index = parseInt(button.dataset.index, 10);
                if (isNaN(index)) return;
                
                if (button.classList.contains('edit-btn')) {
                    saveChanges(); // Guardar cualquier edición pendiente
                    debtors.forEach((d, i) => d.editing = (i === index));
                    renderDebtors();
                } else if (button.classList.contains('delete-btn')) {
                    indexToDelete = index;
                    deleteModal.classList.remove('hidden');
                    passwordInput.focus();
                }
            }
            
            function confirmDelete() {
                if (passwordInput.value === '8384') {
                    if (indexToDelete !== null) {
                        debtors.splice(indexToDelete, 1);
                        saveAndRender();
                        showNotification('Deudor eliminado correctamente.', 'success');
                    }
                    closeDeleteModal();
                } else {
                    showNotification('Clave incorrecta.', 'error');
                    passwordInput.value = '';
                }
            }

            function closeDeleteModal() {
                indexToDelete = null;
                passwordInput.value = '';
                deleteModal.classList.add('hidden');
            }

            function saveAndRender() {
                saveDebtors();
                renderDebtors();
            }

            // --- Event Listeners ---
            debtorsList.addEventListener('click', handleDebtorListClick);
            bottomActionButton.addEventListener('click', handleBottomButtonClick);
            resetMonthBtn.addEventListener('click', resetMonth);
            confirmDeleteBtn.addEventListener('click', confirmDelete);
            cancelDeleteBtn.addEventListener('click', closeDeleteModal);
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) {
                    closeDeleteModal();
                }
            });

            // --- Inicialización ---
            saveAndRender();
        });
    </script>
</body>
</html>
